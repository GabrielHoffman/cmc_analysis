---
title: "Analysis of CMC III"

author: "Gabriel Hoffman"
date: "Run on `r Sys.Date()`"
documentclass: article
output: 
  html_document:
  toc: true
  smart: false
vignette: >
  %\VignetteIndexEntry{CMC II}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\usepackage[utf8]{inputenc}
---

<!--- 

# run analysis
cd /sc/orga/projects/CommonMind/hoffman/cmc_analysis
ml openssl pandoc
R

rmarkdown::render("src/compare_residuals.Rmd", output_dir='./', intermediates_dir='./')

# results:
https://hoffmg01.u.hpc.mssm.edu/commonmind/hoffman/cmc_analysis/
--->


```{r load.packages, echo=FALSE, message=FALSE, results='hide'}
library(ggplot2)
library(gridExtra)
library(grid)
library(tidyverse)
library(synapser)

synLogin()

options(xtable.type="html")

knitr::opts_chunk$set(
  echo=TRUE,
  warning=FALSE,
  message=FALSE,
  error = FALSE,
  tidy = FALSE,
  cache = TRUE,
  cache.lazy = FALSE,
  dev = c("png", "pdf"), 
  fig.width=7, fig.height=7)

options(markdown.HTML.stylesheet = 'css/custom.css')
```



```{r load.residuals, echo=TRUE}
# Load residuals
res_std = read_tsv( synGet("syn21482408")$path )
res_dream = read_tsv( synGet("syn21548452")$path ) 


corRes = sapply( res_std$ensembl_gene_id, function(ensGene){
	x = res_std %>% filter( ensembl_gene_id == ensGene)
	y = res_dream %>% filter( ensembl_gene_id == ensGene)

	cor(as.numeric(x[-1]), as.numeric(y[-1]), use="pairwise.complete.obs")
})
```

# 
```{r plot.correlation, echo=TRUE}
hist(corRes, main="Correlation between residuals from lmFit and dream")
```

```{r load.counts}
# load counts
# counts_filtered = read_tsv( synGet("syn21482405")$path )

# geneMean = rowMeans(counts_filtered[,-1], na.rm=TRUE)
# names(geneMean) = counts_filtered$ensembl_gene_id

# identical(names(geneMean), names(corRes))

# plot(geneMean, corRes)

```






















